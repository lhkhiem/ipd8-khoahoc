/**
 * Script to create metadata for /about page
 * 
 * Usage: npx ts-node src/scripts/createAboutMetadata.ts
 */

import sequelize from '../config/database';

const DEFAULTS = {
  seo: {
    home: { title: 'Banyco', description: '', ogImage: '', slug: '/' },
    pages: [],
  },
};

async function createAboutMetadata() {
  try {
    console.log('ðŸš€ Creating metadata for /about page...\n');

    // 1. Fetch current SEO settings
    const [seoRow] = await sequelize.query(
      'SELECT value FROM settings WHERE namespace = :ns',
      {
        type: 'SELECT' as any,
        replacements: { ns: 'seo' },
      }
    ) as any[];

    const seoSettings = seoRow?.[0]?.value ?? DEFAULTS.seo;
    const existingPages = seoSettings.pages || [];

    // 2. Check if /about metadata already exists
    const existingAbout = existingPages.find((p: any) => p.path === '/about');
    
    if (existingAbout) {
      console.log('â„¹ï¸  Metadata for /about already exists:');
      console.log('   Title:', existingAbout.title);
      console.log('   Description:', existingAbout.description?.substring(0, 50) + '...');
      console.log('   Enabled:', existingAbout.enabled !== false);
      console.log('\nðŸ’¡ To update, please use CMS Admin â†’ Settings â†’ SEO & Meta');
      return;
    }

    // 3. Create new metadata for /about
    const aboutMetadata = {
      path: '/about',
      title: 'Vá» ChÃºng TÃ´i - Banyco Spa Solutions',
      description: 'Giá»›i thiá»‡u Banyco â€“ Ä‘á»‘i tÃ¡c cung cáº¥p giáº£i phÃ¡p & thiáº¿t bá»‹ spa chuyÃªn nghiá»‡p, Ä‘á»“ng hÃ nh phÃ¡t triá»ƒn váº­n hÃ nh vÃ  tá»‘i Æ°u hoÃ¡ lá»£i nhuáº­n.',
      ogImage: '/images/og-about.jpg',
      keywords: ['Banyco', 'Spa Solutions', 'Thiáº¿t bá»‹ spa', 'Giáº£i phÃ¡p spa'],
      enabled: true,
      autoGenerated: false, // Custom metadata, not auto-generated
    };

    // 4. Add to pages array
    existingPages.push(aboutMetadata);

    // 5. Save to settings
    const updatedSettings = {
      ...seoSettings,
      pages: existingPages,
    };

    await sequelize.query(
      `INSERT INTO settings (namespace, value, updated_at)
       VALUES (:ns, :val::jsonb, NOW())
       ON CONFLICT (namespace) DO UPDATE SET value = EXCLUDED.value, updated_at = NOW()`,
      {
        type: 'INSERT' as any,
        replacements: {
          ns: 'seo',
          val: JSON.stringify(updatedSettings),
        },
      }
    );

    console.log('âœ… Created metadata for /about page:');
    console.log('   Path:', aboutMetadata.path);
    console.log('   Title:', aboutMetadata.title);
    console.log('   Description:', aboutMetadata.description);
    console.log('   OG Image:', aboutMetadata.ogImage);
    console.log('\nðŸ’¡ You can now customize this metadata in CMS Admin â†’ Settings â†’ SEO & Meta');
  } catch (error) {
    console.error('âŒ Error creating metadata:', error);
    throw error;
  }
}

// Run the script
createAboutMetadata()
  .then(() => {
    console.log('\nâœ… Script completed successfully');
    process.exit(0);
  })
  .catch((error) => {
    console.error('\nâŒ Script failed:', error);
    process.exit(1);
  })
  .finally(async () => {
    await sequelize.close();
  });














